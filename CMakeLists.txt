INCLUDE(ExternalProject)
CMAKE_MINIMUM_REQUIRED(VERSION 3.3)
PROJECT(VulpesSceneKit)

SET(CMAKE_CXX_STANDARD 17)
SET(CMAKE_CXX_STANDARD_REQUIRED ON)

FILE(GLOB GEOMETRIES "${CMAKE_CURRENT_SOURCE_DIR}/include/geometries/*.hpp" "${CMAKE_CURRENT_SOURCE_DIR}/src/geometries/*.cpp")
FILE(GLOB CAMERAS "${CMAKE_CURRENT_SOURCE_DIR}/include/camera/*.hpp" "${CMAKE_CURRENT_SOURCE_DIR}/src/camera/*.cpp")
FILE(GLOB LIGHTS "${CMAKE_CURRENT_SOURCE_DIR}/include/lights/*.hpp" "${CMAKE_CURRENT_SOURCE_DIR}/src/lights/*.cpp")
FILE(GLOB MATH "${CMAKE_CURRENT_SOURCE_DIR}/include/math/*.hpp" "${CMAKE_CURRENT_SOURCE_DIR}/src/math/*.cpp")
FILE(GLOB SCENE "${CMAKE_CURRENT_SOURCE_DIR}/include/scene/*.hpp" "${CMAKE_CURRENT_SOURCE_DIR}/src/scene/*.cpp")
FILE(GLOB UTIL "${CMAKE_CURRENT_SOURCE_DIR}/include/util/*.hpp" "${CMAKE_CURRENT_SOURCE_DIR}/include/util/*.h"
               "${CMAKE_CURRENT_SOURCE_DIR}/src/util/*.cpp" "${CMAKE_CURRENT_SOURCE_DIR}/src/util/*.cc")
FILE(GLOB IMGUI "${CMAKE_CURRENT_SOURCE_DIR}/third_party/imgui/*.hpp" "${CMAKE_CURRENT_SOURCE_DIR}/third_party/imgui/*.cpp")
FILE(GLOB GUI "${CMAKE_CURRENT_SOURCE_DIR}/include/gui/*.hpp" "${CMAKE_CURRENT_SOURCE_DIR}/src/gui/*.cpp")
FILE(GLOB_RECURSE GUI_ADDONS "${CMAKE_CURRENT_SOURCE_DIR}/include/gui/addons/*.hpp" "${CMAKE_CURRENT_SOURCE_DIR}/src/gui/addons/*.cpp")
FILE(GLOB_RECURSE SHADERS "${CMAKE_CURRENT_SOURCE_DIR}/rsrc/*.vert" "${CMAKE_CURRENT_SOURCE_DIR}/rsrc/*.frag" "${CMAKE_CURRENT_SOURCE_DIR}/rsrc/*.spv" 
    "${CMAKE_CURRENT_SOURCE_DIR}/rsrc/*.comp" "${CMAKE_CURRENT_SOURCE_DIR}/rsrc/*.geom")
FILE(GLOB RENDER "${CMAKE_CURRENT_SOURCE_DIR}/include/render/*.hpp" "${CMAKE_CURRENT_SOURCE_DIR}/src/render/*.cpp")
FILE(GLOB PASSES "${CMAKE_CURRENT_SOURCE_DIR}/include/pass/*.hpp" "${CMAKE_CURRENT_SOURCE_DIR}/src/pass/*.cpp")
FILE(GLOB FEATURES "${CMAKE_CURRENT_SOURCE_DIR}/include/features/*.hpp" "${CMAKE_CURRENT_SOURCE_DIR}/src/features/*.cpp")
FILE(GLOB RESOURCES "${CMAKE_CURRENT_SOURCE_DIR}/include/resources/*.hpp" "${CMAKE_CURRENT_SOURCE_DIR}/src/resources/*.cpp")

SOURCE_GROUP("geometries" FILES ${GEOMETRIES})
SOURCE_GROUP("render" FILES ${RENDER})
SOURCE_GROUP("cameras" FILES ${CAMERAS})
SOURCE_GROUP("lights" FILES ${LIGHTS})
SOURCE_GROUP("math" FILES ${MATH})
SOURCE_GROUP("scene" FILES ${SCENE})
SOURCE_GROUP("util" FILES ${UTIL})
SOURCE_GROUP("imgui" FILES ${IMGUI})
SOURCE_GROUP("gui" FILES ${GUI})
SOURCE_GROUP("gui addons" FILES ${GUI_ADDONS})
SOURCE_GROUP("shaders" FILES ${SHADERS})
SOURCE_GROUP("shader tools" FILES ${SHADER_TOOLS})
SOURCE_GROUP("pass" FILES ${PASSES})
SOURCE_GROUP("feature" FILES ${FEATURES})
SOURCE_GROUP("resources" FILES ${RESOURCES})

FIND_PACKAGE(Vulkan REQUIRED)

SET(TINYOBJLOADER_LIBRARY_DIR "${CMAKE_CURRENT_SOURCE_DIR}/ext/lib/")
ADD_SUBDIRECTORY("third_party/tinyobjloader")
ADD_SUBDIRECTORY("third_party/vulpesrender")
ADD_SUBDIRECTORY("third_party/shadergen")
ADD_SUBDIRECTORY("third_party/shadertools")

ADD_LIBRARY(VulpesSceneKit STATIC ${RESOURCES} ${GEOMETRIES} ${FEATURES} ${PASSES} ${SHADER_TOOLS} ${RENDER} 
                                  ${CAMERAS} ${LIGHTS} ${MATH} ${SCENE} ${UTIL} ${IMGUI} ${GUI} ${GUI_ADDONS} 
                                  ${SHADERS})
TARGET_INCLUDE_DIRECTORIES(VulpesSceneKit PUBLIC $<BUILD_INTERFACE:${Vulkan_INCLUDE_DIRS}> )
TARGET_LINK_LIBRARIES(VulpesSceneKit INTERFACE ${Vulkan_LIBRARIES})

IF(MSVC)
    SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} /std:c++17 /Gm")
ELSEIF(UNIX)
    # Enables more symbols to be loaded when debugging with GDB
    TARGET_COMPILE_DEFINITIONS(VulpesSceneKit PUBLIC "-DGLIBCXX_DEBUG")
    # Somehow, GLFW gets made x64 but this and VPR can get made as x86
    SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -m64")
ENDIF()
TARGET_INCLUDE_DIRECTORIES(VulpesSceneKit PUBLIC "${CMAKE_CURRENT_SOURCE_DIR}/ext/include")
TARGET_INCLUDE_DIRECTORIES(VulpesSceneKit PUBLIC "${CMAKE_CURRENT_SOURCE_DIR}/third_party/vulpesrender/include")
TARGET_INCLUDE_DIRECTORIES(VulpesSceneKit PUBLIC "${CMAKE_CURRENT_SOURCE_DIR}/third_party/shadergen/include")
TARGET_INCLUDE_DIRECTORIES(VulpesSceneKit PUBLIC "${CMAKE_CURRENT_SOURCE_DIR}/third_party/shadertools/include")
TARGET_INCLUDE_DIRECTORIES(VulpesSceneKit PUBLIC "${CMAKE_CURRENT_SOURCE_DIR}/include")
TARGET_INCLUDE_DIRECTORIES(VulpesSceneKit PUBLIC "${CMAKE_CURRENT_SOURCE_DIR}/third_party/assimp/include")
TARGET_INCLUDE_DIRECTORIES(VulpesSceneKit PUBLIC "$ENV{VULKAN_SDK}/include")
TARGET_INCLUDE_DIRECTORIES(VulpesSceneKit PUBLIC "${CMAKE_CURRENT_SOURCE_DIR}/third_party/")
TARGET_INCLUDE_DIRECTORIES(VulpesSceneKit PRIVATE "${CMAKE_CURRENT_SOURCE_DIR}")

TARGET_COMPILE_DEFINITIONS(VulpesSceneKit PUBLIC -DGLM_LANG_STL11_FORCED)
TARGET_COMPILE_DEFINITIONS(VulpesSceneKit PUBLIC -DGLM_ENABLE_EXPERIMENTAL -DGLM_FORCE_DEPTH_ZERO_TO_ONE -DGLM_FORCE_RADIANS)

OPTION(BUILD_EX_SCENES "Build example scenes" ON)

IF(BUILD_EX_SCENES) 

ADD_EXECUTABLE(ClusteredForward "demoscenes/ClusteredForward.cpp")
TARGET_INCLUDE_DIRECTORIES(ClusteredForward PUBLIC "${CMAKE_CURRENT_SOURCE_DIR}/include" "${CMAKE_CURRENT_SOURCE_DIR}/ext/include/VulpesRender" 
"${CMAKE_CURRENT_SOURCE_DIR}/ext/include" "$ENV{VULKAN_SDK}/include" "${CMAKE_CURRENT_SOURCE_DIR}")
TARGET_LINK_LIBRARIES(ClusteredForward PUBLIC VulpesSceneKit tinyobjloader VulpesRender)
TARGET_LINK_LIBRARIES(ClusteredForward PUBLIC ShaderGen ShaderTools)
TARGET_COMPILE_DEFINITIONS(ClusteredForward PUBLIC -DGLM_LANG_STL11_FORCED)
TARGET_COMPILE_DEFINITIONS(ClusteredForward PUBLIC -DGLM_ENABLE_EXPERIMENTAL -DGLM_FORCE_DEPTH_ZERO_TO_ONE -DGLM_FORCE_RADIANS)


#ADD_EXECUTABLE(Triangle "demoscenes/Triangle.cpp")
#TARGET_INCLUDE_DIRECTORIES(Triangle PUBLIC "${CMAKE_CURRENT_SOURCE_DIR}/include" "${CMAKE_CURRENT_SOURCE_DIR}/ext/include/VulpesRender" 
#"${CMAKE_CURRENT_SOURCE_DIR}/ext/include" "$ENV{VULKAN_SDK}/include" "${CMAKE_CURRENT_SOURCE_DIR}")
#TARGET_LINK_LIBRARIES(Triangle PUBLIC VulpesSceneKit tinyobjloader VulpesRender)
#TARGET_COMPILE_DEFINITIONS(Triangle PUBLIC -DGLM_LANG_STL11_FORCED)
#TARGET_COMPILE_DEFINITIONS(Triangle PUBLIC -DGLM_ENABLE_EXPERIMENTAL -DGLM_FORCE_DEPTH_ZERO_TO_ONE -DGLM_FORCE_RADIANS)

#ADD_EXECUTABLE(House "demoscenes/House.cpp")
#TARGET_INCLUDE_DIRECTORIES(House PUBLIC "${CMAKE_CURRENT_SOURCE_DIR}/include" "${CMAKE_CURRENT_SOURCE_DIR}/ext/include/VulpesRender" 
#"${CMAKE_CURRENT_SOURCE_DIR}/ext/include" "$ENV{VULKAN_SDK}/include" "${CMAKE_CURRENT_SOURCE_DIR}")
#TARGET_LINK_LIBRARIES(House PUBLIC VulpesSceneKit tinyobjloader VulpesRender)
#ADD_DEPENDENCIES(House VulpesSceneKit)
#TARGET_COMPILE_DEFINITIONS(House PUBLIC -DGLM_LANG_STL11_FORCED)
#TARGET_COMPILE_DEFINITIONS(House PUBLIC -DGLM_ENABLE_EXPERIMENTAL -DGLM_FORCE_DEPTH_ZERO_TO_ONE -DGLM_FORCE_RADIANS)

#ADD_EXECUTABLE(Icosphere "demoscenes/IcosphereScene.cpp")
#TARGET_INCLUDE_DIRECTORIES(Icosphere PUBLIC "${CMAKE_CURRENT_SOURCE_DIR}/include" "${CMAKE_CURRENT_SOURCE_DIR}/ext/include/VulpesRender" 
#    "${CMAKE_CURRENT_SOURCE_DIR}/ext/include" "$ENV{VULKAN_SDK}/include" "${CMAKE_CURRENT_SOURCE_DIR}")
#TARGET_LINK_LIBRARIES(Icosphere PUBLIC VulpesSceneKit tinyobjloader VulpesRender)
#TARGET_COMPILE_DEFINITIONS(Icosphere PUBLIC -DGLM_LANG_STL11_FORCED)
#TARGET_COMPILE_DEFINITIONS(Icosphere PUBLIC -DGLM_ENABLE_EXPERIMENTAL -DGLM_FORCE_DEPTH_ZERO_TO_ONE -DGLM_FORCE_RADIANS)

#ADD_EXECUTABLE(Tether "demoscenes/Tether.cpp")
#TARGET_INCLUDE_DIRECTORIES(Tether PUBLIC "${CMAKE_CURRENT_SOURCE_DIR}/include" "${CMAKE_CURRENT_SOURCE_DIR}/ext/include/VulpesRender" 
#    "${CMAKE_CURRENT_SOURCE_DIR}/ext/include" "$ENV{VULKAN_SDK}/include" "${CMAKE_CURRENT_SOURCE_DIR}")
#TARGET_LINK_LIBRARIES(Tether PUBLIC VulpesSceneKit tinyobjloader VulpesRender)
#TARGET_COMPILE_DEFINITIONS(Tether PUBLIC -DGLM_LANG_STL11_FORCED)

ENDIF()
